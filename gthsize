#!/bin/bash
# Script by Ypnose  <linuxien[AT]legtux[DOT]org>
# You need bc calculator
# Do not spam it, because you'll reach API Rate Limit!

usage() {
	echo "Usage: ${0##*/} [USER] [REPOSITORY]"
	echo "   [USER] -> Github user"
	echo -e "   [REPOSITORY] -> Repository owned by previous user\n"
}

if [[ -z "$1" || "$1" = -h ]]; then
	usage
	exit
fi

if [[ ! $# = 2 ]]; then
	usage
	exit
fi

USER=$1
REPO=$2
GET=$(curl -s https://api.github.com/repos/$1/$2 | awk '/"size"/ {gsub (/,/,""); print $2}')
NUMBR=$(curl -s https://api.github.com/repos/$1/$2 | awk '/"size"/ {gsub (/,/,""); print $2}' | wc -l)

if [[ $NUMBR != 1 ]]; then
	unset GET
	GET=$(curl -s https://api.github.com/repos/$1/$2 | awk '/"size"/ && count++ == 1 {gsub (/,/,""); print $2}')
fi

if [[ ! -z $GET && $GET -gt 1024 ]]; then
	TOT=$(echo "scale=2; $GET/1024" | bc)
	echo -e "\e[0;32m${TOT}\e[0m Mb"
	exit
fi

if [[ ! -z $GET ]]; then
	echo -e "\e[0;32m${GET}\e[0m kB"
	else
	echo -e "\e[0;31mGithub repository not found!\e[0m"
fi

exit
