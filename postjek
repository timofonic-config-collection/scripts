#!/bin/sh
#   Script by Ypnose  <linuxien[AT]legtux[DOT]org>
#   Generate "ready-to-write" Jekyll posts & pages.

DIR=/mnt/public/REPOS/JekyBlog

if [ -z "$1" ] || [ "$1" = "-h" ]; then
	echo "Usage: ${0##*/} [OPTARG]"
	echo "     :OPTARG"
	echo -e "    -p 	Create a new page instead of a new post/article\n"
	exit
fi

# Generate page
if [ "$1" = "-p" ] && [ -n "$2" ]; then
	NEWFOL=$(echo "$2" | awk '{print tolower($_)}')
	mkdir -p "$DIR/$NEWFOL" && cd "$DIR/$NEWFOL"
	echo -e "\033[0;33mYou may rename the folder!\033[0m"
	echo "---" > index.markdown
	echo "layout: page" >> index.markdown
	echo "title: \"$2\"" >> index.markdown
	echo "---" >> index.markdown
	exit
fi

# Generate post
TIMDAT=$(date "+%Y-%m-%d")
NAME=$(echo "$1" | awk '{gsub (/ /,"-");print tolower($_)}')
ART="$TIMDAT-$NAME.markdown"

if [ -d "$DIR/_posts" ]; then
	cd "$DIR/_posts"
	echo "---" > $ART
	echo "layout: post" >> $ART
	echo "title: \"$1\"" >> $ART
	echo "description: \"\"" >> $ART
	echo "date: $TIMDAT `date \"+%H:%M:%S\"`" >> $ART
	echo "categories:" >> $ART
	echo "---" >> $ART
else
	echo -e "\033[0;31mDirectory doesn't exist!\033[0m"
	exit
fi
exit
